{{ $project:= site.Data.project }}
{{ if (index site.Data site.Language.Lang).project }}
{{ $project = (index site.Data site.Language.Lang).project }}
{{ end }}

{{ $name:= $project.longname }}
{{ $description:= $project.description }}

{{ $sections:= site.Data.sections }}
{{ if (index site.Data site.Language.Lang).sections }}
{{ $sections = (index site.Data site.Language.Lang).sections }}
{{ end }}

{{/* TODO: Create a transparent background-image, or allow for it to not exist */}}
{{ $backgroundImage:= "/images/site/empty-background.jpg" }}
{{ if $project.backgroundImage }}
{{ $backgroundImage = $project.backgroundImage }}
{{ end }}


{{ $projectLogo:= "/images/default-avatar.png" }}
{{ if $project.logo.main }}
{{ $projectLogo = $project.logo.main }}
{{ end }}
{{ $projectLogo := resources.Get $projectLogo }}

{{/* apply image processing. don't use "Fit" in svg or gif because its not supported */}}
{{ if and $projectLogo (and (ne $projectLogo.MediaType.SubType "svg") ( ne $projectLogo.MediaType.SubType "gif")) }}
{{ $projectLogo = $projectLogo.Fit "148x148" }}
{{ end }}
{{/* get file that matches the filename as specified as src="" in shortcode */}}
{{ $src := resources.Get $backgroundImage }}

{{/* set image sizes, these are hardcoded for now, x dictates that images are resized to this width */}}

{{ $tinyw := default "500x" }}
{{ $smallw := default "800x" }}
{{ $mediumw := default "1200x" }}
{{ $largew := default "1500x" }}

{{/* resize the src image to the given sizes */}}

{{ $tiny := $src.Resize $tinyw }}
{{ $small := $src.Resize $smallw }}
{{ $medium := $src.Resize $mediumw }}
{{ $large := $src.Resize $largew }}

{{/* only use images smaller than or equal to the src (original) image size, as Hugo will upscale small images */}}
{{/* set the sizes attribute to (min-width: 35em) 1200px, 100vw unless overridden in shortcode */}}

{{ if lt $src.Width "500" }}
{{ $tiny := $src}}
{{ $small := $src}}
{{ $medium := $src}}
{{ $large := $src}}
{{ end }}

{{ if lt $src.Width "800" }}
{{ $small := $src}}
{{ $medium := $src}}
{{ $large := $src}}
{{ end }}

{{ if lt $src.Width "1200" }}
{{ $medium := $src}}
{{ $large := $src}}
{{ end }}

{{ if lt $src.Width "1500" }}
{{ $large := $src}}
{{ end }}

<div class="container-fluid intro" id="intro">
  <style>
    /* 0 to 299 */
    #introPageBackgroundImageDivStyled {
      background-image: url('{{ $tiny.RelPermalink }}');
    }

    /* 300 to X */
    @media (min-width: 500px) and (max-width: 800px) {

      /* or 301 if you want really the same as previously.  */
      #introPageBackgroundImageDivStyled {
        background-image: url('{{ $small.RelPermalink }}');
      }
    }

    @media (min-width: 801px) and (max-width: 1200px) {

      /* or 301 if you want really the same as previously.  */
      #introPageBackgroundImageDivStyled {
        background-image: url('{{ $medium.RelPermalink }}');
      }
    }

    @media (min-width: 1201px) and (max-width: 1500px) {

      /* or 301 if you want really the same as previously.  */
      #introPageBackgroundImageDivStyled {
        background-image: url('{{ $large.RelPermalink }}');
      }
    }

    @media (min-width: 1501px) {

      /* or 301 if you want really the same as previously.  */
      #introPageBackgroundImageDivStyled {
        background-image: url('{{ $src.RelPermalink }}');
      }
    }

    video {
      width: 45vw;
      /* 25% of the viewport width */
      height: 45vh;
      /* 25% of the viewport height */
    }

    .left-half,
    .right-half {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .left-half {
        padding: 10%; /* Border of 20% on each side */
            box-sizing: border-box; 
    }
  </style>
    <span class="on-the-fly-behavior"></span>
    <div
      id="homePageBackgroundImageDivStyled"
      class="background container-fluid"
    ></div>
  <div class="row content">
    <div class="col-md-6 stretch-left left-half">
      <span class="description">
      {{ $description | markdownify }}
    </span>
    </div>
    <div class="col-md-6 right-half d-flex justify-content-center align-items-center">
      <video controls class="video" autoplay >
        <source src="videos/screencast.webm" type="video/webm">
        Your browser does not support the video tag.
      </video>
    </div>
    {{ if $sections }}
    {{ range first 2 (where (sort $sections "section.weight") ".section.enable" true) }}
      {{ $sectionID := replace (lower .section.name) " " "-"  }}
      {{ if .section.id }}
        {{ $sectionID = .section.id }}
      {{ end }}
      <a href="#{{ $sectionID }}" class="arrow-center" aria-label="{{ i18n "read" }} {{ i18n "more" }} - {{ $name }}"><i class="arrow bounce fa fa-chevron-down"></i></a>
    {{ end }}
  {{ end }}
  </div>
</div>